#!/usr/bin/env bash

set -e

[ -n "$ASDF_INSTALL_PATH" ] || (echo "Missing ASDF_INSTALL_PATH" 1>&2 && exit 1)
[ "$ASDF_INSTALL_TYPE" != "version" ] && (echo "asdf-mongosh supports release installs only" 1>&2 && exit 1)

# shellcheck source=bin/download
[ -f "$ASDF_DOWNLOAD_PATH/mongosh" ] || . "$(dirname "$0")/download"

(
  mkdir -p "$ASDF_INSTALL_PATH/bin" &&
    mv "$ASDF_DOWNLOAD_PATH/mongosh" "$ASDF_INSTALL_PATH/bin/mongosh" &&
    chmod +x "$ASDF_INSTALL_PATH/bin/mongosh" &&
    echo "mongosh has been installed." &&
    exit 0
) || (
  rm -rf "$ASDF_INSTALL_PATH" &&
    echo "An error ocurred while installing mongosh $ASDF_INSTALL_VERSION" 1>&2 &&
    exit 1
)
