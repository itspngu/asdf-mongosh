#!/bin/bash

set -e

: "${ASDF_INSTALL_PATH:?"Missing ASDF_INSTALL_PATH"}"
: "${ASDF_INSTALL_TYPE:?"asdf-mongosh supports release installs only"}"

: "${ASDF_DOWNLOAD_PATH:?"Missing ASDF_DOWNLOAD_PATH"}"

# shellcheck source=SCRIPTDIR/download
[ -f "$ASDF_DOWNLOAD_PATH" ] || . "$(dirname "$0")/download"

(
  mv "$ASDF_DOWNLOAD_PATH" "$ASDF_INSTALL_PATH" &&
    ls -lah "$ASDF_INSTALL_PATH/$ASDF_INSTALL_VERSION" &&
    chmod -R +x "$ASDF_INSTALL_PATH/$ASDF_INSTALL_VERSION/bin" &&
    echo "mongosh has been installed."
) || (
  rm -rf "${ASDF_INSTALL_PATH:?}/$ASDF_INSTALL_VERSION" "$ASDF_DOWNLOAD_PATH" &&
    echo "An error ocurred while installing mongosh $ASDF_INSTALL_VERSION" 1>&2 &&
    exit 1
)
