#!/bin/bash

set -e

: "${ASDF_INSTALL_VERSION:?"Missing ASDF_INSTALL_VERSION"}"
: "${ASDF_DOWNLOAD_PATH:?"Missing ASDF_DOWNLOAD_PATH"}"

case "$(uname -s)" in
  "Darwin")
    RELEASE_FILENAME="mongosh-$ASDF_INSTALL_VERSION-darwin.zip"
    ;;
  "Linux")
    RELEASE_FILENAME="mongosh-$ASDF_INSTALL_VERSION-linux.tgz"
    ;;
  *)
    echo "Unknown operating system" 1>&2 && exit 1
    ;;
esac

(
  curl -fsSL "https://github.com/mongodb-js/mongosh/releases/download/v$ASDF_INSTALL_VERSION/$RELEASE_FILENAME" |
    tar xf - -C "$ASDF_DOWNLOAD_PATH" &&
    exit 0
) || (
  echo "Download failed" 1>&2 &&
    exit 1
)
