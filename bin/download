#!/usr/bin/env bash

set -e

[ -n "$ASDF_INSTALL_VERSION" ] || (echo "Missing ASDF_INSTALL_VERSION" 1>&2 && exit 1)
[ -n "$ASDF_DOWNLOAD_PATH" ] || (echo "Missing ASDF_DOWNLOAD_PATH" 1>&2 && exit 1)

case "$(uname -s)" in
  "Darwin")
    RELEASE_FILENAME="mongosh-$ASDF_INSTALL_VERSION-darwin.zip"
    ;;
  "Linux")
    RELEASE_FILENAME="mongosh-$ASDF_INSTALL_VERSION-linux.tgz"
    ;;
  *)
    echo "Unknown operating system" 1>&2 && exit 1
    ;;
esac

(
  curl -fsSL "https://github.com/mongodb-js/mongosh/releases/download/v$ASDF_INSTALL_VERSION/$RELEASE_FILENAME" |
    tar xzf - -C "$ASDF_DOWNLOAD_PATH" &&
    exit 0
) || (
  echo "Download failed" 1>&2 &&
    exit 1
)
